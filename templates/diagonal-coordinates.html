<!DOCTYPE html>
<html lang="createElement">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename= 'css/map.css') }}"
    />
    <title>Document</title>

    <style>
      h1 {
        text-align: center;
        margin-top: 20px;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 30px;
      }

      body {
        font-family: Arial, sans-serif;
        background-color: #f5f5f5;
        margin: 0;
        padding: 0;
      }

      form {
        max-width: 500px;
        margin: 20px auto;
        background-color: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
      }

      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #444;
      }

      input[type="number"] {
        width: 100%;
        padding: 10px;
        border: 2px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
        margin-bottom: 10px;
        font-size: 16px;
      }

      button[type="submit"] {
        background-color: #4caf50;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        margin: 0 auto;
        display: block;
      }

      button[type="submit"]:hover {
        background-color: #3e8e41;
      }

      #ans {
        display: flex;
        justify-content: center;
      }
    </style>
  </head>
  <body>
    <h1>Earth Engine Web App</h1>
    <div class="home-button">
      <a href="/">Home</a>
    </div>
    <form>
      <label for="top-left-lat">Top-Left Latitude:</label>
      <input
        type="number"
        id="top-left-lat"
        name="top-left-lat"
        step="any"
      /><br />

      <label for="top-left-long">Top-Left Longitude:</label>
      <input
        type="number"
        id="top-left-long"
        name="top-left-long"
        step="any"
      /><br />

      <label for="bottom-right-lat">Bottom-Right Latitude:</label>
      <input
        type="number"
        id="bottom-right-lat"
        name="bottom-right-lat"
        step="any"
      /><br />

      <label for="bottom-right-long">Bottom-Right Longitude:</label>
      <input
        type="number"
        id="bottom-right-long"
        name="bottom-right-long"
        step="any"
      /><br />

      <button type="submit">Submit</button>
    </form>

    <script>
      // get the form element
      const form = document.querySelector("form");

      // add an event listener to the form for when it is submitted
      form.addEventListener("submit", function (event) {
        // prevent the default form submission behavior
        event.preventDefault();

        // get the values of the form inputs
        const topLeftLat = parseFloat(
          document.querySelector("#top-left-lat").value
        );
        const topLeftLong = parseFloat(
          document.querySelector("#top-left-long").value
        );
        const bottomRightLat = parseFloat(
          document.querySelector("#bottom-right-lat").value
        );
        const bottomRightLong = parseFloat(
          document.querySelector("#bottom-right-long").value
        );

        // validate the input values
        if (
          isNaN(topLeftLat) ||
          isNaN(topLeftLong) ||
          isNaN(bottomRightLat) ||
          isNaN(bottomRightLong)
        ) {
          alert("Please enter valid coordinates.");
          return;
        }

        // calculate the other two corner coordinates
        const topRightLat = topLeftLat;
        const topRightLong = bottomRightLong;
        const bottomLeftLat = bottomRightLat;
        const bottomLeftLong = topLeftLong;

        // create an array of the corner coordinates in clockwise order
        const coordinates = [
          [topLeftLong, topLeftLat],
          [topRightLong, topRightLat],
          [bottomRightLong, bottomRightLat],
          [bottomLeftLong, bottomLeftLat],
          [topLeftLong, topLeftLat],
        ];

        // log the resulting coordinates to the console
        console.log(coordinates);

        const s = JSON.stringify(coordinates);
        console.log(s);
        console.log("Type of request to Python server is ", typeof s);
        console.log("JSON Stringified input:", s);
        const targetArea = document.getElementById("ans");
        targetArea.innerHTML = `<p>Calculating...</p>`
        $.ajax({
          url: "/calculate",
          type: "POST",
          contentType: "application/json",
          data: JSON.stringify(s),
          success: function (response) {
            console.log("Type of response from server is: ", typeof response);
            console.log("Response from the server", response); // Log the response from the server
            // const data = response
            // Parse the response string to a JSON object
            console.log(response); // Log the parsed JSON object
            /// Inside the AJAX success callback

            const table = document.createElement("table");

            // Create header row
            const headerRow = document.createElement("tr");
            const header1 = document.createElement("th");
            // header1.innerText = "Key";
            const header2 = document.createElement("th");
            // header2.innerText = "Value";
            headerRow.appendChild(header1);
            headerRow.appendChild(header2);
            table.appendChild(headerRow);

            // Create rows for each key-value pair in the response object
            for (const [key, value] of Object.entries(response)) {
              const row = document.createElement("tr");
              const cell1 = document.createElement("td");
              cell1.innerText = key;
              const cell2 = document.createElement("td");
              if (typeof value === "object") {
                // If the value is an object, create a sub-table
                const subTable = document.createElement("table");
                for (const [subKey, subValue] of Object.entries(value)) {
                  const subRow = document.createElement("tr");
                  const subCell1 = document.createElement("td");
                  subCell1.innerText = subKey;
                  const subCell2 = document.createElement("td");
                  subCell2.innerText = subValue;
                  subRow.appendChild(subCell1);
                  subRow.appendChild(subCell2);
                  subTable.appendChild(subRow);
                }
                cell2.appendChild(subTable);
              } else {
                // If the value is not an object, just display it in a cell
                cell2.innerText = value;
              }
              row.appendChild(cell1);
              row.appendChild(cell2);
              table.appendChild(row);
            }
            // Replace the contents of the ans div with the table
            targetArea.innerHTML = "";
            targetArea.appendChild(table);
          },

          error: function (xhr, status, error) {
            console.log(error); // Log any errors
            console.log('gg error')
            targetArea.innerHTML = `<p>The selected area is very large for computation, please check the coordinates and try again</p>`
          },
        });
      });
    </script>
    <div id="ans"></div>
  </body>
</html>
